# Морской бой

## Правила игры
В одной игре _два_ бота играют друг против друга.
_Игра_ делится на несколько _сетов_. Каждый сет проходит по следующим правилам.

В начале сета каждый из ботов создаёт карту с кораблями. Карта представляет собой клетчатое поле размером 10х10. Любая клетка карты либо пуста, либо содержит палубу. 

Одна или несколько палуб, расположенных подряд (строго по горизонтали или по вертикали), образуют корабль. Всего на карте должны располагаться 4 корабля из одной палубы, 3 корабля из двух палуб, 2 корабля из трёх палуб и один корабль из четырёх палуб. Корабли не должны соприкасаться (в том числе по диагонали) и иметь изгибов.

Карта соперника изначально неизвестна боту. После создания карт выбирается, какой из ботов будет стрелять первым. Выбранный бот совершает выстрел в одну из клеток карты соперника. В результате может произойти одно из следующих событий:
- _промах_: выстрел попал в пустую клетку карты
- _корабль ранен (подбит)_: выстрел попал в клетку с палубой корабля, но у этого корабля есть другие палубы, в которые ещё не было попаданий
- _корабль убит (потоплен)_: выстрел попал в клетку с палубой корабля, и у этого корабля больше не осталось палуб, в которые не было попаданий

Если бот промахнулся, то право выстрела переходит сопернику. В противном случае право выстрела остаётся у бота, и следующий выстрел совершает он же. _В рамках сета запрещается стрелять несколько раз в одну и ту же клетку._

Выстрелы совершаются до тех пор, пока все корабли одного из ботов не будут убиты (потоплены). Такой бот считается _проигравшим в сете,_ а его соперник — _победителем сета_.

После этого начинается следующий сет. Боты создают новые карты, а право первого выстрела чередуется между сетами.

Для всей игры задаётся параметр — _максимальное количество сетов_. Бот, одержавший победу в наибольшем количестве сетов, побеждает по всей игре. Если после проведения максимального количества сетов оба бота одержали победу в одинаковом количестве сетов, в игре объявляется ничья.

Если победитель известен до проведения максимального количества сетов, игра останавливается. Например, _максимальное количество сетов_ = 7, и после проведения 4 сетов один из ботов уже одержал 4 победы; в этом случае победитель игры однозначно определён, и игра останавливается. 

## Разработка ботов

### Порядок запуска и остановки ботов
Каждый бот, участвующий в турнире, _запускается перед началом игры и останавливается после неё._ Таким образом, время жизни бота равно одной игре. Перед началом следующей игры бот будет снова запущен и после следующей игры будет снова остановлен и т.д.

Следовательно, состояние бота (т.е. состояние его памяти — значения переменных и т.д.) сохраняется на протяжении одной игры. Каждую игру бот начинает из начального состояния.

### Интерфейс бота и порядок вызовов
Для разработки ботов требуется написать реализацию его интерфейса на одном из поддерживаемых языков программирования. Интерфейс содержит следующие функции:

|Функция|Параметры|Возвращает|Описание|Ограничение по времени|
|---|---|---|---|---|
|`setParameters`|`setCount: int`||Вызывается один раз перед началом игры.  <br>Передаёт параметры, с которыми запущен турнир:  <br>- `setCount`: максимальное количество сетов в игре|5 секунд|
|`onGameStart`|_Нет_||Вызывается один раз в начале игры.|5 секунд|
|`onSetStart`|_Нет_||Вызывается один раз в начале сета.|5 секунд|
|`getMap`|_Нет_|`int[][]`|Возвращает карту с расстановкой кораблей.  <br>Вызывается в начале каждого сета (каждый сет можно делать новую расстановку).  <br>Карта должна иметь размер 10х10 и быть заполнена следующим образом:  <br>- 0 - пустая клетка  <br>- 1 - клетка с палубой корабля  <br>На карте должно быть четыре 1-палубника, три 2-палубника, два 3-палубника и один 4-палубник.  <br>Корабли должны быть расположены строго вертикально или горизонтально (т.е., не иметь изгибов).  <br>Корабли не должны соприкасаться.|1.5 секунды|
|`shoot`|_Нет_|`int[]`|Возвращает координаты клетки, в которую на текущем ходу стреляет бот.  <br>Координаты задаются массивом из двух целых чисел.  <br>Первая соответствует строке (координата по вертикали), вторая - столбцу (координата по горизонтали).  <br>Отсчёт ведётся с левого верхнего угла.  <br>Т.е., чтобы выстрелить в клетку `map[i][j]`, необходимо вернуть `[i, j]`.  <br>Результат выстрела будет гарантированно передан следующим вызовом через  <br>`shotResult`.|1.5 секунды|
|`shotResult`|`resultCode: int`||Вызывается сразу после `shoot`, чтобы передать результат выстрела.  <br>Возможные значения  <br>`resultCode`:  <br>- 0 - Промах  <br>- 2 - Корабль соперника ранен (подбит)  <br>- 3 - Корабль соперника убит (подбиты все палубы)|1.5 секунды|
|`onOpponentShot`|`cell: int[]`||Вызывается после выстрела соперника.  <br>Параметр  <br>`cell` - координаты клетки, в которую выстрелил соперник.|1.5 секунды|
|`onSetEnd`|_Нет_||Вызывается один раз в конце сета.|5 секунд|
|`onGameEnd`|_Нет_||Вызывается один раз в конце игры.|5 секунд|
  
  
Во время игры функции вызываются в следующем порядке:
1. `setParameters` перед игрой
2. `onGameStart`
3. `onSetStart` в начале каждого сета
4. `getMap` **в начале каждого сета**
5. **либо** `shoot` **и затем** `shotResult`**, либо** `onOpponentShot` **в цикле до конца сета**
6. `onSetEnd` в конце каждого сета
7. `onGameEnd`

На каждый из вызовов установлено ограничение времени, в течение которого бот должен выполнить вызванную функцию.
Обратите внимание, что если противник выполняет вызовы некорректно (см. ниже в правилах проведения турнира), то игра может быть закончена досрочно, и вызов `onGameEnd()` может произойти раньше ожидаемого.

### Координаты поля
Как указано в комментарии к `shoot`, координаты выстрелов строятся начиная с левого верхнего угла, от 0 до 9. Первая координата — по вертикали, вторая — по горизонтали. Это соответствует индексированию массивов/списков в большинстве языков программирования: если нужно сделать выстрел в клетку `map[i][j]`, координаты выстрела — `[i, j]`.
Например, такая карта:
```Python
[
    [1, 0, 1, 0, 1, 0, 1, 0, 0, 0],
    [0, 0, 1, 0, 1, 0, 1, 0, 0, 0],
    [1, 0, 0, 0, 1, 0, 1, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 1, 0, 0, 0],
    [1, 0, 1, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 1, 0, 1, 0, 0, 0, 0, 0],
    [1, 0, 0, 0, 1, 0, 0, 0, 0, 0],
    [0, 0, 1, 0, 1, 0, 0, 0, 0, 0],
    [0, 0, 1, 0, 0, 0, 0, 0, 0, 0],
    [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
]
```
Выглядит следующим образом:

![Пример карты](./map-example.png)

Однопалубники расположены по координатам (0, 0), (2, 0), (4, 0), (6, 0).

### Шаблоны ботов для разных языков программирования
При создании нового бота в AI Battle, откроется редактор кода с уже заполненным шаблоном для бота. _Шаблон бота не реализует никакой разумной стратегии, но корректно играет по правилам и сразу может быть принят в турнир._

В этом репозитории можно найти шаблоны для [Pascal (FPC 3.2.0)](./template.pas) и [Python 3.9](./template.py).
    
### Проверка бота перед принятием в турнир
Для того, чтобы бот был принят в турнир, он должен отвечать двум требованиям:
- код не должен содержать ошибок, препятствующих запуску бота
- бот должен играть по установленным правилам

Для этого, после нажатия кнопки "Отправить", выполняются следующие шаги:
1. Бот компилируется (для интерпретируемых языков — этап компиляции либо пропускается, либо состоит в проверке корректности синтаксиса)
2. Выполняется одна тестовая игра с ботом (максимальное количество сетов = 3).

В случае возникновения ошибок на данных этапах после отправки будут показаны уведомления на странице редактирования бота. Доступны ошибки и предупреждения компиляции, лог тестовой игры, вывод бота во время тестовой игры.

## Правила проведения турнира
Для каждого запуска турнира задаётся один параметр: _максимальное количество сетов_.

Каждый бот играет с каждым по одному разу. Например, если в турнире 5 участников, всего будет проведено 4 + 3 + 2 + 1 = 10 игр.

Если в игре объявлена ничья, оба участника получают по 1 очку. Если один из ботов одержал победу, он получает 3 очка, а его противник — 0 очков.

Турнирная таблица строится по сумме полученных очков. Чем больше очков у бота, тем выше он в турнирной таблице. Если два бота получили одинаковое количество очков в рамках турнира, они располагаются на одном месте.

### Исключительные ситуации
Во время проведения игры могут возникать исключительные ситуации: один из ботов может остановиться из-за программной ошибки, не ответить в рамках отведённого времени, или вернуть некорректный результат.

Все вызовы в игре выполняются одновременно для обоих участников. Если один и тот же вызов (например, `shoot`) один из ботов выполнил некорректно (не ответил, сыграл не по правилам и т.д.), а второй — корректно, то второй бот объявляется победителем игры. Если оба бота выполнили вызов некорректно, _оба бота получают 0 очков._

После некорректного ответа _бот не исключается из турнира и будет продолжать участвовать в следующих играх_.

#### Примеры игры не по правилам
Как указано выше, игра не по правилам автоматически приводит к поражению бота во всей игре. Примеры игры не по правилам:
- бот создал карту некорректного размера
- в клетках карты есть значения, отличные от 0 и 1
- на карте неверное количество кораблей (например, 5 однопалубников или только один трёхпалубник)
- корабли на карте соприкасаются друг с другом (в том числе по диагонали)
- во время выстрела бот вернул неверное количество координат (не две)
- координаты выстрела выходят за пределы карты
- бот выстрелил в клетку, в которую уже стрелял в рамках этого сета